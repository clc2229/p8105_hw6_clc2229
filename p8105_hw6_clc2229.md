Homework 6
================
Christopher Crowe
November 16, 2018

### Problem 1

The code chunk below puts the data in a format that is appropriate for modeling. For example, it ensures that predictors of interest are the appropriate data types and removes data from some cities that do not report some data.

``` r
homicides = read.csv("./data/homicide-data.csv")

homicides = 
  homicides %>% 
  mutate(city_state = paste(city, state, sep = ", "),
         resolved = as.numeric(disposition == "Closed by arrest"),
         victim_race_2 = case_when(
           victim_race == "Asian" ~ "Non-White",
           victim_race == "Black" ~ "Non-White",
           victim_race == "Hispanic" ~ "Non-White",
           victim_race == "Other" ~ "Non-White",
           victim_race == "Unknown" ~ "Non-White",
           victim_race == "White" ~ "White"
         ),
         victim_race = factor(victim_race_2, levels = c("White", "Non-White")),
         victim_age = as.numeric(as.character(victim_age))
  ) %>% 
  filter(city_state != "Dallas, TX" & city_state != "Phoenix, AZ" & city_state != "Kansas City, MO" & city_state != "Tulsa, AL")
```

    ## Warning in evalq(as.numeric(as.character(victim_age)), <environment>): NAs
    ## introduced by coercion

The following code chunk runs a logistic regression on the dataset and extracts the OR comparing the odds of having a solved homicide for Non-Whites vs. Whites and the corresponding 95% upper and lower confidence limits in Baltimore, MD.

``` r
fit_logistic = 
  homicides %>% 
  filter(city_state == "Baltimore, MD") %>% 
  glm(resolved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())

fit_logistic %>% 
  broom::tidy() %>% 
  janitor::clean_names() %>% 
  mutate(OR = exp(estimate),
         lower_cl = exp(estimate - (1.96 * std_error)),
         upper_cl = exp(estimate + (1.96 * std_error))
  ) %>%
  filter(term == "victim_raceNon-White") %>% 
  select(OR, lower_cl, upper_cl) %>% 
  knitr::kable(digits = 3)
```

|     OR|  lower\_cl|  upper\_cl|
|------:|----------:|----------:|
|  0.441|      0.313|       0.62|

The following code chunk extracts the OR and 95% CI for each city/state in the dataset.

``` r
nest_glm_res =
  homicides %>% 
  group_by(city_state) %>% 
  nest() %>% 
  mutate(models = map(data, ~lm(resolved ~ victim_age + victim_sex + victim_race, data = .x)),
         models = map(models, broom::tidy)) %>% 
  select(-data)

nest_glm_res %>% 
  unnest() %>% 
  janitor::clean_names() %>% 
  mutate(OR = exp(estimate),
         lower_cl = exp(estimate - (1.96 * std_error)),
         upper_cl = exp(estimate + (1.96 * std_error))
  ) %>% 
  filter(term == "victim_raceNon-White") %>% 
  select(city_state, OR, lower_cl, upper_cl) %>% 
  knitr::kable(digits = 3)
```

| city\_state        |     OR|  lower\_cl|  upper\_cl|
|:-------------------|------:|----------:|----------:|
| Albuquerque, NM    |  0.938|      0.844|      1.043|
| Atlanta, GA        |  0.936|      0.824|      1.064|
| Baltimore, MD      |  0.824|      0.762|      0.892|
| Baton Rouge, LA    |  0.912|      0.766|      1.087|
| Birmingham, AL     |  1.010|      0.888|      1.148|
| Boston, MA         |  0.675|      0.587|      0.776|
| Buffalo, NY        |  0.797|      0.693|      0.917|
| Charlotte, NC      |  0.898|      0.812|      0.994|
| Chicago, IL        |  0.882|      0.834|      0.932|
| Cincinnati, OH     |  0.786|      0.703|      0.880|
| Columbus, OH       |  0.962|      0.894|      1.035|
| Denver, CO         |  0.886|      0.783|      1.002|
| Detroit, MI        |  0.900|      0.839|      0.966|
| Durham, NC         |  1.001|      0.814|      1.232|
| Fort Worth, TX     |  0.958|      0.867|      1.059|
| Fresno, CA         |  0.854|      0.751|      0.972|
| Houston, TX        |  0.967|      0.915|      1.022|
| Indianapolis, IN   |  0.849|      0.796|      0.907|
| Jacksonville, FL   |  0.902|      0.844|      0.964|
| Las Vegas, NV      |  0.937|      0.884|      0.993|
| Long Beach, CA     |  0.949|      0.805|      1.118|
| Los Angeles, CA    |  0.906|      0.839|      0.980|
| Louisville, KY     |  0.806|      0.735|      0.885|
| Memphis, TN        |  0.949|      0.872|      1.033|
| Miami, FL          |  0.881|      0.798|      0.972|
| Milwaukee, wI      |  0.905|      0.821|      0.997|
| Minneapolis, MN    |  0.899|      0.771|      1.048|
| Nashville, TN      |  0.976|      0.907|      1.050|
| New Orleans, LA    |  0.837|      0.753|      0.931|
| New York, NY       |  0.880|      0.774|      1.002|
| Oakland, CA        |  0.722|      0.628|      0.829|
| Oklahoma City, OK  |  0.909|      0.833|      0.992|
| Omaha, NE          |  0.705|      0.636|      0.783|
| Philadelphia, PA   |  0.904|      0.847|      0.964|
| Pittsburgh, PA     |  0.750|      0.665|      0.846|
| Richmond, VA       |  0.863|      0.720|      1.034|
| San Antonio, TX    |  0.915|      0.832|      1.007|
| Sacramento, CA     |  0.947|      0.836|      1.072|
| Savannah, GA       |  0.882|      0.734|      1.060|
| San Bernardino, CA |  0.970|      0.799|      1.176|
| San Diego, CA      |  0.851|      0.766|      0.947|
| San Francisco, CA  |  0.837|      0.757|      0.927|
| St. Louis, MO      |  0.873|      0.801|      0.951|
| Stockton, CA       |  0.787|      0.675|      0.917|
| Tampa, FL          |  1.037|      0.875|      1.228|
| Tulsa, OK          |  0.897|      0.827|      0.972|
| Washington, DC     |  0.855|      0.731|      0.999|

### Problem 2

The following code chunk reads in the data.

``` r
birthweight = read.csv("./data/birthweight.csv") %>% 
  mutate(
    babysex = case_when(
      babysex == 1 ~ "Male",
      babysex == 2 ~ "Female"),
    babysex = fct_relevel(babysex, "Male"),
    frace = case_when(
      frace == 1 ~ "White",
      frace == 2 ~ "Black",
      frace == 3 ~ "Asian",
      frace == 4 ~ "Puerto Rican",
      frace == 8 ~ "Other",
      frace == 9 ~ "Unknown"
      ),
    frace = fct_relevel(frace, "White"),
    mrace = case_when(
      mrace == 1 ~ "White",
      mrace == 2 ~ "Black",
      mrace == 3 ~ "Asian",
      mrace == 4 ~ "Puerto Rican",
      mrace == 8 ~ "Other"
      ),
    mrace = fct_relevel(mrace, "White"),
    malform = case_when(
      malform == 1 ~ "Present",
      malform == 0 ~ "Absent"
    ),
    malform = fct_relevel(malform, "Absent")
    )
  

birthweight %>% 
  ggplot(aes(x = gaweeks, y = bwt)) +
  geom_point()
```

![](p8105_hw6_clc2229_files/figure-markdown_github/unnamed-chunk-4-1.png)

``` r
model_2 = lm(bwt ~ blength + gaweeks, data = birthweight)

model_3 = lm(bwt ~ bhead + blength + babysex + bhead*blength*babysex + bhead*blength + bhead*babysex + blength+babysex, data = birthweight)
```
